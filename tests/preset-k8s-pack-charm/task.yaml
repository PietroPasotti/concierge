summary: Run concierge with the k8s preset, try to pack a charm
systems:
  - ubuntu-24.04

execute: |
  pushd "${PROJECT_PATH}/tests/preset-k8s-pack-charm"

  "$PROJECT_PATH"/concierge --trace prepare -p k8s

  mkdir test-charm
  pushd test-charm
  charmcraft init --author concierge
  charmcraft pack --verbose

restore: |
  if [[ -z "${CI:-}" ]]; then
    "$PROJECT_PATH"/concierge --trace restore
  fi
